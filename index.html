<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagliFlex - Sistema di Gestione Produzione</title>
    <link rel="stylesheet" href="magliflex-production-plan-css.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Login Overlay -->
    <div id="loginOverlay" class="login-overlay show">
        <div class="login-container">
            <h2>Accesso MagliFlex</h2>
            <div class="form-group">
                <label for="usernameInput">Nome Utente:</label>
                <input type="text" id="usernameInput" placeholder="Inserisci il tuo nome utente">
            </div>
            <div class="form-group">
                <label for="passwordInput">Password:</label>
                <input type="password" id="passwordInput" placeholder="Inserisci la tua password">
            </div>
            <button class="btn btn-primary" onclick="loginUser()">Accedi</button>
            <p class="login-info">Credenziali Admin Iniziali: username "admin", password "adminpass"</p>
        </div>
    </div>

    <!-- Main Application Content -->
    <div id="appContent" style="display: none;">
        <header>
            <div class="header-left">
                <button class="hamburger-btn" onclick="toggleNavMenu()">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
                <h1>MagliFlex</h1>
            </div>
            <div class="header-right">
                <button class="btn notification-btn" onclick="openNotificationsModal()">
                    Messaggi Importanti <span id="notificationBadge" class="badge">0</span>
                </button>
                <button class="btn btn-secondary" onclick="logoutUser()">Logout</button>
            </div>
        </header>

        <nav id="mainNavMenu">
            <button class="nav-btn active" onclick="showPage('dashboard')">Dashboard</button>
            <button class="nav-btn" onclick="showPage('phases')">Fasi</button>
            <button class="nav-btn" onclick="showPage('machines')">Macchinari</button>
            <button class="nav-btn" onclick="showPage('departments')">Reparti</button>
            <button class="nav-btn" onclick="showPage('rawMaterials')">Materie Prime</button>
            <button class="nav-btn" onclick="showPage('articles')">Articoli</button>
            <button class="nav-btn" onclick="showPage('planning')">Pianificazione</button>
            <button class="nav-btn" onclick="showPage('schedule')">Programma</button>
            <button class="nav-btn" onclick="showPage('settings')">Impostazioni</button>
            <button class="nav-btn" onclick="showPage('users')">Gestione Utenti</button> <!-- New User Management Button -->
        </nav>

        <main>
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <h2>Dashboard</h2>
                <section class="dashboard-section">
                    <h3>Statistiche Generali</h3>
                    <div id="generalStats" class="stats-grid">
                        <!-- Stats will be loaded here by JS -->
                    </div>
                </section>
                <section class="dashboard-section">
                    <h3>Utilizzo Macchinari</h3>
                    <div id="machineStats" class="stats-grid">
                        <!-- Machine usage will be loaded here by JS -->
                    </div>
                </section>
                <section class="dashboard-section">
                    <h3>Prossime Consegne</h3>
                    <div id="upcomingDeliveries" class="stats-list">
                        <!-- Upcoming deliveries will be loaded here by JS -->
                    </div>
                </section>
                <section class="dashboard-section">
                    <h3>Carico di Lavoro Settimanale (Reparti)</h3>
                    <div id="workloadChart" class="chart-container">
                        <!-- Chart will be rendered here by JS (placeholder) -->
                    </div>
                </section>
            </div>

            <!-- Phases Page -->
            <div id="phases" class="page">
                <h2>Gestione Fasi di Lavorazione</h2>
                <div class="form-section">
                    <h3>Aggiungi/Modifica Fase</h3>
                    <div class="form-group">
                        <label for="phaseName">Nome Fase:</label>
                        <input type="text" id="phaseName" placeholder="Es. Tessitura, Rammaglio">
                    </div>
                    <div class="form-group">
                        <label for="phaseTime">Tempo di Lavorazione (minuti per pezzo):</label>
                        <input type="number" id="phaseTime" min="1" step="1" placeholder="Es. 60">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" id="savePhaseBtn" onclick="addPhase()">Aggiungi Fase</button>
                        <button class="btn btn-secondary" id="cancelPhaseBtn" onclick="cancelEdit('phases')" style="display: none;">Annulla</button>
                    </div>
                </div>

                <div class="table-section">
                    <h3>Fasi Esistenti</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome Fase</th>
                                <th>Tempo (min/pezzo)</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="phasesTable">
                            <!-- Phases will be loaded here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Machines Page -->
            <div id="machines" class="page">
                <h2>Gestione Macchinari</h2>
                <div class="form-section">
                    <h3>Aggiungi/Modifica Macchinario</h3>
                    <div class="form-group">
                        <label for="machineName">Nome Macchinario:</label>
                        <input type="text" id="machineName" placeholder="Es. Rettilinea F12 (A)">
                    </div>
                    <div class="form-group">
                        <label for="machineCapacity">Capacità Giornaliera (pezzi/giorno):</label>
                        <input type="number" id="machineCapacity" min="1" step="1" placeholder="Es. 35">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" id="saveMachineBtn" onclick="addMachine()">Aggiungi Macchinario</button>
                        <button class="btn btn-secondary" id="cancelMachineBtn" onclick="cancelEdit('machines')" style="display: none;">Annulla</button>
                    </div>
                </div>

                <div class="table-section">
                    <h3>Macchinari Esistenti</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome (Tipo, Finezza)</th>
                                <th>Capacità (pz/giorno)</th>
                                <th>Utilizzo Attuale</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="machinesTable">
                            <!-- Machines will be loaded here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Departments Page -->
            <div id="departments" class="page">
                <h2>Gestione Reparti</h2>
                <div class="form-section">
                    <h3>Aggiungi/Modifica Reparto</h3>
                    <div class="form-group">
                        <label for="departmentId">Seleziona Reparto:</label>
                        <select id="departmentId" onchange="loadDepartmentForEdit()">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="departmentName">Nome Reparto:</label>
                        <input type="text" id="departmentName" placeholder="Es. Tessitura Rettilinea">
                    </div>
                    <div class="form-group">
                        <label for="departmentMachineTypes">Tipi di Macchine (separati da virgola):</label>
                        <input type="text" id="departmentMachineTypes" placeholder="Es. Rettilinea, Integrale">
                        <small>Devono corrispondere ai "Tipi" definiti in Anagrafica Macchinari.</small>
                    </div>
                    <div class="form-group">
                        <label for="departmentFinenesses">Finezze Gestite (numeri separati da virgola):</label>
                        <input type="text" id="departmentFinenesses" placeholder="Es. 7, 12, 14 (lascia vuoto per tutte)">
                        <small>Devono corrispondere alle "Finezze" definite in Anagrafica Macchinari.</small>
                    </div>
                     <div class="form-group">
                        <label for="departmentPhaseIds">Fasi di Lavorazione (seleziona più opzioni):</label>
                        <select id="departmentPhaseIds" multiple size="5">
                            <!-- Phases populated by JS -->
                        </select>
                        <small>Tieni premuto CTRL/CMD per selezionare più fasi.</small>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" id="saveDepartmentBtn" onclick="saveDepartment()">Aggiungi Reparto</button>
                        <button class="btn btn-secondary" id="cancelDepartmentBtn" onclick="cancelEdit('departments')" style="display: none;">Annulla</button>
                    </div>
                </div>

                <div class="table-section">
                    <h3>Reparti Esistenti</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Tipi Macchine</th>
                                <th>Finezze</th>
                                <th>Fasi Associate</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="departmentsTable">
                            <!-- Departments will be loaded here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Raw Materials Page -->
            <div id="rawMaterials" class="page">
                <h2>Gestione Materie Prime e Magazzino</h2>
                <div class="form-section">
                    <h3>Carico Materia Prima</h3>
                    <div class="form-group">
                        <label for="rawMaterialSelect">Materia Prima:</label>
                        <select id="rawMaterialSelect" onchange="toggleNewRawMaterialInput()">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    <div class="form-group" id="newRawMaterialNameGroup" style="display: none;">
                        <label for="newRawMaterialName">Nome Nuova Materia Prima:</label>
                        <input type="text" id="newRawMaterialName" placeholder="Es. Filato di Cotone">
                    </div>
                    <div class="form-group">
                        <label for="rawMaterialUnit">Unità di Misura (Es. kg, pz, m):</label>
                        <input type="text" id="rawMaterialUnit" placeholder="Es. kg">
                    </div>
                    <div class="form-group">
                        <label for="rawMaterialBarcode">Barcode (opzionale):</label>
                        <input type="text" id="rawMaterialBarcode" placeholder="Scansiona o digita barcode">
                        <small>Dopo aver scansionato, premi Invio o il pulsante per caricare la quantità.</small>
                    </div>
                    <div class="form-group">
                        <label for="rawMaterialQuantity">Quantità Caricata/Aggiunta:</label>
                        <input type="number" id="rawMaterialQuantity" min="0" step="0.01" value="0">
                    </div>
                    <div class="form-group">
                        <label for="rawMaterialLoadDate">Data Carico:</label>
                        <input type="date" id="rawMaterialLoadDate">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" id="saveRawMaterialBtn" onclick="addRawMaterialOrStock()">Aggiungi Materia Prima</button>
                        <button class="btn btn-secondary" id="cancelRawMaterialBtn" onclick="cancelEdit('rawMaterials')" style="display: none;">Annulla</button>
                    </div>
                </div>

                <div class="table-section">
                    <h3>Scorte Attuali</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Materia Prima</th>
                                <th>Quantità</th>
                                <th>Unità</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="rawMaterialsStockTable">
                            <!-- Raw materials stock will be loaded here by JS -->
                        </tbody>
                    </table>
                </div>

                <div class="table-section">
                    <h3>Giornale di Magazzino</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Materia Prima</th>
                                <th>Tipo Movimento</th>
                                <th>Quantità</th>
                                <th>Stato Consumo</th>
                                <th>Lotto Riferimento</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="warehouseJournalTable">
                            <!-- Warehouse journal will be loaded here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Articles Page -->
            <div id="articles" class="page">
                <h2>Gestione Articoli</h2>
                <div class="form-section">
                    <h3>Aggiungi/Modifica Articolo</h3>
                    <div class="form-group">
                        <label for="articleId">Seleziona Articolo:</label>
                        <select id="articleId" onchange="loadArticleForEdit()">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="articleCode">Codice Articolo:</label>
                        <input type="text" id="articleCode" placeholder="Es. MAG_UOMO_001">
                    </div>
                    <div class="form-group">
                        <label for="articleDescription">Descrizione:</label>
                        <input type="text" id="articleDescription" placeholder="Es. Maglione basic in cotone">
                    </div>
                    <div class="form-group">
                        <label for="articleColor">Colore (Opzionale):</label>
                        <input type="text" id="articleColor" placeholder="Es. Grigio Melange">
                    </div>
                    <div class="form-group">
                        <label for="articleClient">Cliente (Opzionale):</label>
                        <input type="text" id="articleClient" placeholder="Es. Retail Moda SpA">
                    </div>

                    <h4>Ciclo di Lavorazione</h4>
                    <div id="cycleSteps" class="dynamic-list-container">
                        <!-- Cycle steps will be added here by JS -->
                    </div>
                    <button class="btn btn-secondary" onclick="addCycleStep()">Aggiungi Fase al Ciclo</button>

                    <h4>Distinta Base (BOM)</h4>
                    <div id="bomItems" class="dynamic-list-container">
                        <!-- BOM items will be added here by JS -->
                    </div>
                    <button class="btn btn-secondary" onclick="addBomItem()">Aggiungi Materia Prima alla BOM</button>

                    <div class="form-actions">
                        <button class="btn btn-primary" id="saveArticleBtn" onclick="saveArticle()">Aggiungi Articolo</button>
                        <button class="btn btn-secondary" id="cancelArticleBtn" onclick="cancelEdit('articles')" style="display: none;">Annulla</button>
                    </div>
                </div>

                <div class="table-section">
                    <h3>Articoli Esistenti</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Codice</th>
                                <th>Descrizione</th>
                                <th>Colore</th>
                                <th>Cliente</th>
                                <th>Ciclo di Lavorazione</th>
                                <th>Distinta Base</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="articlesTable">
                            <!-- Articles will be loaded here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Planning Page -->
            <div id="planning" class="page">
                <h2>Pianificazione Produzione</h2>
                <div class="form-section">
                    <h3>Aggiungi/Modifica Lotto</h3>
                    <div class="form-group">
                        <label for="planningLotId">Seleziona Lotto Esistente:</label>
                        <select id="planningLotId" onchange="loadPlanningForEdit()">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="planningArticle">Articolo:</label>
                        <select id="planningArticle">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="planningQuantity">Quantità (pezzi):</label>
                        <input type="number" id="planningQuantity" min="1" step="1" placeholder="Es. 100">
                    </div>
                    <div class="form-group">
                        <label for="planningType">Tipo di Pianificazione:</label>
                        <select id="planningType">
                            <option value="production">Produzione</option>
                            <option value="sampling">Campionatura</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="planningPriority">Priorità:</label>
                        <select id="planningPriority">
                            <option value="low">Bassa</option>
                            <option value="medium">Media</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="planningNotes">Note (Opzionale):</label>
                        <textarea id="planningNotes" placeholder="Dettagli aggiuntivi per il lotto"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="planningStartDate">Data di Inizio Desiderata:</label>
                        <input type="date" id="planningStartDate">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="calculateDelivery()">Calcola Consegna</button>
                        <button class="btn btn-primary" id="savePlanningBtn" onclick="savePlanning()" style="display: none;">Aggiungi alla Pianificazione</button>
                        <button class="btn btn-secondary" id="cancelPlanningBtn" onclick="cancelEdit('planning')" style="display: none;">Annulla</button>
                    </div>
                    <div id="deliveryResult" class="result-box">
                        <p>Seleziona un articolo e una quantità per calcolare la data di consegna stimata.</p>
                    </div>
                </div>

                <div class="table-section">
                    <h3>Lotti in Pianificazione</h3>
                    <div id="planningList" class="planning-cards-container">
                        <!-- Planning items will be loaded here by JS -->
                    </div>
                </div>

                <div class="form-section import-section">
                    <h3>Importa Piani da JSON</h3>
                    <textarea id="jsonImportArea" rows="10" placeholder='Incolla qui l\'array JSON di oggetti piano, es: [{ "articleId": 1001, "quantity": 50, "priority": "high", "startDate": "YYYY-MM-DD" }]'></textarea>
                    <button class="btn btn-primary" onclick="importPlansFromJson()">Importa Piani</button>
                </div>
            </div>

            <!-- Schedule Page (Calendars) -->
            <div id="schedule" class="page">
                <h2>Programma di Consegne e Carico di Lavoro</h2>
                <section class="calendar-section">
                    <h3>Calendario Consegne</h3>
                    <div class="calendar-nav">
                        <button class="btn" onclick="navigateDeliveryWeek(-7)">Settimana Precedente</button>
                        <span id="currentDeliveryWeekRange"></span>
                        <button class="btn" onclick="navigateDeliveryWeek(7)">Settimana Successiva</button>
                    </div>
                    <div id="deliverySchedule" class="calendar-grid">
                        <!-- Delivery schedule will be loaded here by JS -->
                    </div>
                </section>

                <section class="calendar-section">
                    <h3>Carico di Lavoro Giornaliero per Reparto</h3>
                     <div class="calendar-nav">
                        <button class="btn" onclick="navigateWorkloadWeek(-7)">Settimana Precedente</button>
                        <span id="currentWorkloadWeekRange"></span>
                        <button class="btn" onclick="navigateWorkloadWeek(7)">Settimana Successiva</button>
                    </div>
                    <div id="dailyWorkloadCalendar" class="calendar-grid">
                        <!-- Daily workload calendar will be loaded here by JS -->
                    </div>
                </section>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <h2>Impostazioni e Gestione Dati</h2>
                <div class="form-section">
                    <h3>Esporta Dati</h3>
                    <p>Esporta tutti i dati dell'applicazione (fasi, macchinari, articoli, ecc.) in un file JSON per backup.</p>
                    <button class="btn btn-primary" onclick="exportDataAsJson()">Esporta Dati</button>
                </div>
                <div class="form-section">
                    <h3>Importa Dati</h3>
                    <p>Importa dati da un file JSON di backup. Questo sovrascriverà i dati esistenti.</p>
                    <input type="file" id="importDataFile" accept=".json">
                    <small>Seleziona un file .json.</small>
                </div>
                 <div class="form-section">
                    <h3>Reset Dati</h3>
                    <p>Cancella tutti i dati dell'applicazione e ripristina le impostazioni predefinite e i dati di esempio.</p>
                    <button class="btn btn-danger" onclick="confirmResetData()">Reset Dati</button>
                </div>
            </div>

            <!-- New: User Management Page -->
            <div id="users" class="page">
                <h2>Gestione Utenti</h2>
                <div class="form-section">
                    <h3>Aggiungi/Modifica Utente</h3>
                    <div class="form-group">
                        <label for="usernameInputForm">Nome Utente:</label>
                        <input type="text" id="usernameInputForm" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label for="passwordInputForm">Password:</label>
                        <input type="password" id="passwordInputForm" placeholder="password">
                    </div>
                    <div class="form-group">
                        <label>Ruoli:</label>
                        <div id="userRolesCheckboxes" class="checkbox-group">
                            <label><input type="checkbox" value="admin"> Amministratore</label>
                            <label><input type="checkbox" value="planning"> Pianificazione</label>
                            <label><input type="checkbox" value="warehouse"> Magazzino</label>
                            <!-- Add more roles as needed -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="forcePasswordChangeCheckbox">Forza cambio password al prossimo accesso:</label>
                        <input type="checkbox" id="forcePasswordChangeCheckbox">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" id="saveUserBtn" onclick="saveUser()">Aggiungi Utente</button>
                        <button class="btn btn-secondary" id="cancelUserBtn" onclick="cancelEdit('users')" style="display: none;">Annulla</button>
                    </div>
                </div>

                <div class="table-section">
                    <h3>Utenti Registrati</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome Utente</th>
                                <th>Password</th>
                                <th>Ruoli</th>
                                <th>Forza Cambio Pass</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>

    <!-- Modals -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeNotificationsModal()">&times;</span>
            <h3>Messaggi Importanti</h3>
            <div class="notification-filters">
                <button class="btn active" id="filterUnread" onclick="filterNotifications('unread')">Non Letti</button>
                <button class="btn" id="filterAll" onclick="filterNotifications('all')">Tutti</button>
            </div>
            <div id="notificationsList" class="notification-list">
                <!-- Notifications will be loaded here by JS -->
            </div>
        </div>
    </div>

    <div id="actualConsumptionModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="document.getElementById('actualConsumptionModal').classList.remove('show')">&times;</span>
            <h3>Registra Consumo Effettivo</h3>
            <p id="modalRmInfo"></p>
            <div class="form-group">
                <label for="actualConsumedQuantity">Quantità Effettiva Consumata:</label>
                <input type="number" id="actualConsumedQuantity" min="0" step="0.01">
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" id="confirmActualConsumptionBtn">Conferma Consumo</button>
                <button class="btn btn-secondary" id="cancelActualConsumptionBtn">Annulla</button>
            </div>
        </div>
    </div>

    <div id="editPlanningModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="document.getElementById('editPlanningModal').classList.remove('show')">&times;</span>
            <h3>Modifica Lotto di Pianificazione</h3>
            <input type="hidden" id="editPlanningLotId">
            <div class="form-group">
                <label for="editPlanningArticle">Articolo:</label>
                <select id="editPlanningArticle">
                    <!-- Options populated by JS -->
                </select>
            </div>
            <div class="form-group">
                <label for="editPlanningQuantity">Quantità (pezzi):</label>
                <input type="number" id="editPlanningQuantity" min="1" step="1">
            </div>
            <div class="form-group">
                <label for="editPlanningType">Tipo di Pianificazione:</label>
                <select id="editPlanningType">
                    <option value="production">Produzione</option>
                    <option value="sampling">Campionatura</option>
                </select>
            </div>
            <div class="form-group">
                <label for="editPlanningPriority">Priorità:</label>
                <select id="editPlanningPriority">
                    <option value="low">Bassa</option>
                    <option value="medium">Media</option>
                    <option value="high">Alta</option>
                </select>
            </div>
            <div class="form-group">
                <label for="editPlanningNotes">Note (Opzionale):</label>
                <textarea id="editPlanningNotes"></textarea>
            </div>
            <div class="form-group">
                <label for="editPlanningStartDate">Data di Inizio Desiderata:</label>
                <input type="date" id="editPlanningStartDate">
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" id="saveEditedPlanningBtn">Salva Modifiche</button>
                <button class="btn btn-secondary" id="cancelEditPlanningBtn">Annulla</button>
            </div>
        </div>
    </div>

    <script src="magliflex-production-plan-js.js"></script>
    <script>
        // Function to handle global data reset (moved from app.js to here for simplicity)
        function confirmResetData() {
            if (confirm('ATTENZIONE: Questa azione cancellerà TUTTI i dati salvati e ripristinerà l\'applicazione ai dati predefiniti/di esempio. Sei sicuro di voler procedere?')) {
                logoutUser(false); // Log out and force data reset without showing logout message
                alert('Dati resettati con successo. Verrai reindirizzato alla pagina di login.');
                // After logoutUser, appData is already reset and saved to localStorage.
                // Just ensure the login screen is displayed and app is ready for new login.
                document.getElementById('loginOverlay').classList.add('show');
                document.getElementById('appContent').style.display = 'none';
                document.getElementById('usernameInput').value = '';
                document.getElementById('passwordInput').value = '';
                updateAllTables(); // Re-render with default data
            }
        }
    </script>
</body>
</html>
